- var needDatePicker=true
- var needGoogleMaps=true
include header.jade

.callout.small.secondary
  .row.column.text-center
      h1 Proposer un trajet
        h2.subheader J'ai une voiture

form.row.small-11.small-centered.columns
  h3 Trajet
  .large-6.small-12.column
    .input-group
      span.input-group-label A partir de
      input#from.input-group-field(type="text")
    div#fromMap.map
  .large-6.small-12.column
    .input-group
      span.input-group-label Jusqu'à
      input#to.input-group-field(type="text")
    div#toMap.map
  hr
  h3 Aller
  .small-6.column.large-3.large-offset-3
    .input-group
      span.input-group-label Heure
      select#hour.input-group-field
        - for (var i = 0; i < 24; ++i)
          option(value="#{i}") #{i}
  .small-6.column.large-3.end
    .input-group
      span.input-group-label Minutes
      select#minute.input-group-field
        - for (var i = 0; i < 60; i+=5)
          option(value="#{i}") #{i}
  .small-12.large-6.large-centered.column
    .input-group
      span.input-group-label Date
      input#date.input-group-field(type="text")
  hr
  h3 Etapes
  #stageInput.small-12.column.large-6.large-centered
   .input-group
    span.input-group-label Etape
    input.stage.input-group-field(type="text", autocomplete="off")
  .small-12.column.large-6.large-centered
    a#addStage.small.expanded.button Ajouter une étape
  hr
  h3 Retour
  .small-12.column
    h5 J'effectue un retour
    .switch
      input#twoWay.switch-input(type="checkbox", autocomplete="off")
      label.switch-paddle(for="twoWay")
    #twoWayDiv(style="display: none")
      .small-6.column.large-3.large-offset-3
        .input-group
          span.input-group-label Heure
          select#returnHour.input-group-field
            - for (var i = 0; i < 24; ++i)
              option(value="#{i}") #{i}
      .small-6.column.large-3.end
        .input-group
          span.input-group-label Minutes
          select#returnMinute.input-group-field
            - for (var i = 0; i < 60; i+=5)
              option(value="#{i}") #{i}
      .small-12.large-6.large-centered.column
        .input-group
          span.input-group-label Date
          input#returnDate.input-group-field(type="text")
      // Bug if you remove the following line
      span 
  hr
  h3 Options
  //
    .small-12.column
      h5 Je prends l'autoroute
      .switch
        input#highway.switch-input(type="checkbox", checked)
        label.switch-paddle(for="highway")
  .small-12.column.large-6.large-centered
    .input-group
      span.input-group-label Places disponibles
      select#availableSeats.input-group-field
        - for (var i = 0; i < 6; ++i)
          option(value="#{i}") #{i} 
  hr
  .small-12.large-6.large-centered.column
    button.expanded.button Proposer

  script.
    window.onload = function() {
       createInputMap("from", "fromMap");
       createInputMap("to", "toMap");
       $('#twoWay').click(function() {
         $('#twoWayDiv').toggle(); 
       });   
       $("#date, #returnDate").fdatepicker({
         language: "fr", 
         weekStart: 1,
         format: "dd/mm/yyyy"
       });
      $("#addStage").on('click', function() {
          $(".stage:last").clone().insertAfter(".stage:last");
          AddAutocompleteOnStages();
      });
      function AddAutocompleteOnStages() {
        $(".stage").each(function(index) {
          $(this).off();
          var dumb = new google.maps.places.SearchBox(this);
        });
      }
      AddAutocompleteOnStages();
      $("form").on('submit', function (e) {
        e.preventDefault();
        submitOffer(); 
      });

    }
      
    function submitOffer() {
      var data = {
        "from": $("#from").val(),  
        "to": $("#to").val(),  
        "hour": $("#hour").val(),  
        "minute": $("#minute").val(),  
        "date": $("#date").val(),  
        "stage": $("#stage").val(),  
        "twoWay": $("#twoWay").val(),  
        "returnHour": $("#returnHour").val(),  
        "returnMinute": $("#returnMinute").val(),  
        "returnDate": $("#returnDate").val(),  
        "availableSeats": $("#availableSeats").val(),  
      };
     $.ajax({
        url: "/offer",
        method: "POST",
        contentType: "application/JSON; charset=UTF-8",
        data : JSON.stringify(data)      
      }).success(function() {
        console.log("Success")
        //window.location.href = request.responseText;
      }).error(function() {
        console.log("error")
      }); 
    }

include footer.jade
